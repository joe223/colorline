{"version":3,"sources":["game.js"],"names":["game","canvas","document","getElementById","ctx","getContext","cellCount","cellWidth","lineCount","mode","actions","play","name","action","interval","me","setInterval","draw","stop","clearInterval","colors","start","map","init","ready","onclick","over","alert","clearRect","save","score","restore","clicked","isMoving","e","ratio","offsetWidth","px","offsetX","clientX","offsetLeft","startX","py","offsetY","clientY","offsetTop","startY","width","height","x","parseInt","y","bubble","getBubble","color","move","getRandom","max","Math","random","basic","operate","star1","star2","boom","translate","strokeStyle","font","fillStyle","fillText","stroke","addScore","length","bubbles","genrate","flyin","i","push","Bubble","beginPath","strokeRect","forEach","emptys","getEmptyBubbles","status","times","target","x2","y2","current","step","abs","addBubble","clearLine","row","j","x1","y1","isClick","isEmpty","log","arr1","arr2","arr3","arr4","unshift","line1","getLine","line2","line3","line4","line","concat","p","setBubble","b","p1","moveTo","lineTo","p2","path","search","cell","currentCell","history","goalCell","getCell","parent","child","left","top","right","buttom","distance","c","sort","a","d","empties","result","useds","isUsed","ra","m","thisBubble","Cell","window","count","light","prototype","gradient","createRadialGradient","addColorStop","arc","PI","fill","isUp"],"mappings":"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","file":"game.85106247.map","sourceRoot":"..","sourcesContent":["var game = {\n    canvas: document.getElementById(\"canvas\"),\n    ctx: document.getElementById(\"canvas\").getContext(\"2d\"),\n    cellCount: 10,  //九宫格\n    cellWidth: 30,  //方格大小\n    lineCount: 5,\n    mode: 7,\n    actions: {},\n    // TODO：待看\n    play: function (name, action, interval) {\n        var me = this;\n        this.actions[name] = setInterval(function () {\n            action();\n            me.draw();\n        }, interval || 50);\n    },\n    // TODO：待看\n    stop: function (name) {\n        clearInterval(this.actions[name]);\n        this.draw();\n    },\n    colors: [\"red\", \"#039518\", \"#ff00dc\", \"#ff6a00\", \"gray\", \"#0094ff\", \"#d2ce00\"],\n\n    // 这里是程序的起点\n    // everything from here\n    start: function () {\n        this.map.init();\n        this.ready.init();\n        this.draw();    // 这个其实不在此处执行也行的，因为 ready.flyin 动画的每一帧都会 调用 this.draw 一次\n        this.canvas.onclick = this.onclick;\n    },\n    over: function () {\n        alert(\"GAME OVER\");\n        this.onclick = function () {\n            return false;\n        };\n    },\n    draw: function () {\n        // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/clearRect\n        this.ctx.clearRect(0, 0, 400, 600);\n        // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/save\n        this.ctx.save();\n        this.map.draw();\n        this.ready.draw();\n        this.score.draw();\n        this.ctx.restore();\n    },\n    clicked: null,\n    isMoving: function () {\n        return this.ready.isMoving || this.map.isMoving;\n    },\n    // 棋盘点击处理\n    onclick: function (e) {\n        if (game.isMoving()) {\n            return;\n        }\n        var ratio = game.canvas.offsetWidth / 600\n        // 点击坐标\n        var px = (e.offsetX || (e.clientX - game.canvas.offsetLeft)) - game.map.startX * ratio;\n        var py = (e.offsetY || (e.clientY - game.canvas.offsetTop)) - game.map.startY * ratio;\n        if (px < 0 || py < 0 || px > game.map.width * ratio || py > game.map.height * ratio) {\n            return;\n        }\n        // 获取被点击的格子坐标\n        var x = parseInt(px / (game.cellWidth * ratio));\n        var y = parseInt(py / (game.cellWidth * ratio));\n        var clicked = game.clicked;\n        // 获取被点击的棋子\n        var bubble = game.map.getBubble(x, y);\n        if (bubble.color) {\n            if (clicked) {\n                //同一个棋子不做反映\n                if (clicked.x == x && clicked.y == y) {\n                    return;\n                }\n                clicked.stop();\n            }\n            // 重新选择一颗棋子\n            clicked = game.clicked = bubble;\n            bubble.play();\n        }\n        else {\n            if (clicked) {\n                clicked.stop();\n                //移动被点击的棋子到目的地\n                // bubble 是棋盘上的无色棋子\n                // clicked 是有色棋子\n                game.map.move(clicked, bubble);\n            }\n        }\n        //log(\"x:\" + x + \" y:\" + y);\n    },\n    getRandom: function (max) {\n        return parseInt(Math.random() * 1000000 % (max));\n    },\n};\n/**\n * 计分板\n * @type {{basic: number, operate: number, star1: number, star2: number, boom: number, draw: game.score.draw, addScore: game.score.addScore}}\n */\ngame.score = {\n    basic: 0,\n    operate: 0,\n    star1: 0,\n    star2: 0,\n    boom: 0,\n\n    draw: function () {\n        var startX = game.cellWidth * 10 + game.map.startX;\n        var startY = game.map.startY;\n        var ctx = game.ctx;\n        ctx.save();\n        ctx.translate(startX, startY);\n        ctx.clearRect(0, 0, 150, 400);\n        ctx.strokeStyle = \"#456\";\n        //ctx.strokeRect(0, 0, 150, 200);\n        ctx.font = \"24px 微软雅黑\";\n        ctx.fillStyle = \"#fefefe\";\n        // 这里有算分规则\n        ctx.fillText(\"得分:\" + (this.basic * 5 + this.star1 * 8 + this.star2 * 10 + this.boom * 20), 0, 30);\n        ctx.stroke();\n        ctx.restore();\n    },\n    // 计分\n    addScore: function (length) {\n        switch (length) {\n            case 5:\n                this.basic++;\n                break;\n            case 6:\n                this.star1++;\n                break;\n            case 7:\n                this.star2++;\n                break;\n            default:\n                this.boom++;\n                break;\n        }\n        this.draw();\n    },\n};\n\n/**\n * 这是左上角的棋盒\n * @type {{startX: number, startY: number, width: number, height: number, bubbles: Array, init: game.ready.init, genrate: game.ready.genrate, draw: game.ready.draw, isMoving: boolean, flyin: game.ready.flyin}}\n */\ngame.ready = {\n    startX: 41.5,\n    startY: 21.5,\n    width: game.cellWidth * 3,\n    height: game.cellWidth,\n    bubbles: [],\n    /**\n     * 初始化\n     *      1、生成三枚棋子\n     *      2、三枚棋子飞入棋盘随机位置\n     */\n    init: function () {\n        this.genrate();\n        var me = this;\n        me.flyin();\n    },\n    /**\n     * 随机生成3枚待使用的棋子\n     */\n    genrate: function () {\n        // 并向这三枚棋子附色\n        for (var i = 0; i < 3; i++) {\n            // game.mode 默认值：7\n            // 随机取一种颜色\n            var color = game.colors[game.getRandom(game.mode)];\n            this.bubbles.push(new Bubble(i, 0, color));\n        }\n        //log(this.bubbles);\n    },\n    /**\n     * 绘制棋盒\n     */\n    draw: function () {\n        var ctx = game.ctx;\n        ctx.save();\n        // 移动棋盒到指定位置\n        ctx.translate(this.startX, this.startY);\n        ctx.beginPath();\n        ctx.strokeStyle = \"#555\";\n        ctx.strokeRect(0, 0, this.width, this.height);\n        ctx.stroke();\n        //绘制准备的棋子\n        this.bubbles.forEach(function (bubble) {\n            bubble.draw();\n        });\n\n        ctx.restore();\n    },\n    isMoving: false,\n\n    /**\n     * 棋盒中取三枚棋子到棋盘\n     */\n    flyin: function () {\n        var emptys = game.map.getEmptyBubbles();\n        // 如果剩下的空间不够放3枚棋子，则游戏结束\n        if (emptys.length < 3) {\n            //GAME OVER\n            game.over();\n            return;\n        }\n        var me = this;\n        var status = [0, 0, 0];\n        var times = 1;\n        // 新棋子落入棋盘\n        // game 会在 action 后执行一次 draw 方法\n        game.play(\"flyin\", function () {\n            // 如果三枚棋子都安稳地落入棋盘\n            // 则棋盒中添加三枚棋子\n            if (status[0] && status[1] && status[2]) {\n                // 停止动画\n                game.stop(\"flyin\");\n                me.isMoving = false;\n                status = [0, 0, 0];\n                me.bubbles = [];\n                me.genrate();\n                return;\n            }\n            // 这是一个状态值，当前是否有棋子在移动\n            me.isMoving = true;\n            for (var i = 0; i < me.bubbles.length; i++) {\n                if (status[i]) {\n                    continue;\n                }\n                var target = emptys[i];\n                // 棋子移动的的终点（相对于整个画布）\n                var x2 = target.px + game.map.startX - me.startX;\n                var y2 = target.py + game.map.startY - me.startY;\n                var current = me.bubbles[i];\n                // 每次移动剩下距离的 1/10\n                var step = Math.abs(x2 - current.px)/10 || Math.abs(y2 - current.y)/10;\n                // 如果棋子在目标点左侧\n                if (current.px < x2) {\n                    // y 轴上的移动也是如此\n                    current.py = ((y2 - current.py) / (x2 - current.px)) * step + current.py;\n                    current.px += step;\n                    // 这是坐标纠正措施\n                    if (current.px > x2) {\n                        current.px = x2;\n                    }\n                }\n                // 如果棋子在目标点右侧\n                else if (current.px > x2) {\n                    current.py = ((y2 - current.py) / (current.px - x2)) * step + current.py;\n                    current.px -= step;\n                    if (current.px < x2) {\n                        current.px = x2;\n                    }\n                }\n                // 如果在同一条垂直线上，则只需在 y 轴上移动\n                else {\n                    current.py += step;\n                }\n                if (current.py > y2) {\n                    current.py = y2;\n                }\n                // 如果最后距离终点只有 0.1px ，则算作已经移动到终点\n                if (parseInt(current.px+0.1) == x2 && parseInt(current.py+0.1) == y2) {\n                    status[i] = 1;\n                    current.x = target.x;\n                    current.y = target.y;\n                    // 在棋盘上添加一枚棋子\n                    game.map.addBubble(current);\n                    // 移动到终点后会判断是否形成连珠\n                    game.map.clearLine(current.x, current.y, current.color, false);\n                }\n            }\n        }, 10);\n\n    }\n};\n// 初始棋盘\ngame.map = {\n    startX: 40.5,  //棋盘X坐标\n    startY: 60.5,  //棋盘Y坐标\n    width: game.cellCount * game.cellWidth,\n    height: game.cellCount * game.cellWidth,\n    bubbles: [],\n    init: function () {\n        for (var i = 0; i < game.cellCount; i++) {\n            var row = [];\n            for (var j = 0; j < game.cellCount; j++) {\n                row.push(new Bubble(j, i, null));\n            }\n            this.bubbles.push(row);\n        }\n    },\n\n    /**\n     * 清空穿过这个点的所有五子连线\n     * @param x1    bubble.x\n     * @param y1    bubble.y\n     * @param color bubble.color\n     * @param isClick\n     */\n    clearLine: function (x1, y1, color, isClick) {\n        if (this.isEmpty(x1, y1)) {\n            if (isClick) game.ready.flyin();\n            return;\n        };\n        //给定一个坐标，看是否有满足的line可以被消除\n        //4根线 一  | / \\\n        //横线\n        var current = this.getBubble(x1, y1);\n        if (!current.color) {\n            log(current);\n        }\n        var arr1, arr2, arr3, arr4;\n        // ——\n        arr1 = this.bubbles[y1];\n        // |\n        arr2 = [];\n        for (var y = 0; y < game.cellCount; y++)\n            arr2.push(this.getBubble(x1, y));\n        // \\\n        arr3 = [current];\n        // /\n        arr4 = [current];\n        for (var i = 1; i < game.cellCount ; i++) {\n            // 左上角连线上的点\n            if (x1 - i >= 0 && y1 - i >= 0)\n                arr3.unshift(this.getBubble(x1 - i, y1 - i));\n            // 右下角连线上的点\n            if (x1 + i < game.cellCount && y1 + i < game.cellCount)\n                arr3.push(this.getBubble(x1 + i, y1 + i));\n            // 左下角连线上的点\n            if (x1 - i >= 0 && y1 + i < game.cellCount)\n                arr4.push(this.getBubble(x1 - i, y1 + i));\n            // 右下角连线上的点\n            if (x1 + i < game.cellCount && y1 - i >= 0)\n                arr4.unshift(this.getBubble(x1 + i, y1 - i));\n        }\n        var line1 = getLine(arr1);\n        var line2 = getLine(arr2);\n        var line3 = getLine(arr3);\n        var line4 = getLine(arr4);\n        var line = line1.concat(line2).concat(line3).concat(line4);\n\n        // 动画执行时不干其他的事\n        if (line.length < 5) {\n            if (isClick) game.ready.flyin();\n            return;\n        }\n        else {\n            var me = this;\n            var i = 0;\n\n            // 我们要一颗一颗地删除连在一起的棋子\n            game.play(\"clearline\", function () {\n                if (i == line.length) {\n\n                    game.score.addScore(line.length);\n                    game.stop(\"clearline\");\n\n                    me.isMoving = false;\n                    // game.ready.flyin();\n                    return;\n                }\n                me.isMoving = true;\n                var p = line[i];\n                // 这里仅仅是更新下 bubble 的配色参数，其实此时并不会有 UI 上的变化\n                me.setBubble(p.x, p.y, null);\n                i++;\n            }, 1000);\n        }\n        function getLine(bubbles) {\n\n            var line = [];\n            for (var i = 0; i < bubbles.length; i++) {\n                var b = bubbles[i];\n                if (b.color == color) {\n                    line.push({ \"x\": b.x, \"y\": b.y });\n                }\n                else {\n                    // 小于 5 个连珠则返回\n                    if (line.length < 5)\n                        line = [];\n                    // 尽可能匹配多的连珠\n                    else\n                        return line;\n                }\n            }\n            // 如果 bubbles 数组中的连珠都同色，但是小于 5，则前面不会 return\n            // 所以在这里判断下\n            if (line.length < 5)\n                return [];\n            return line;\n        }\n    },\n    /**\n     * 绘制棋盘以及棋盘上的（看不见）棋子\n     */\n    draw: function () {\n        var ctx = game.ctx;\n        // 保留之前的绘制\n        ctx.save();\n        // 棋盘的位置\n        ctx.translate(this.startX, this.startY);\n        // 开始画格子\n        ctx.beginPath();\n        for (var i = 0; i <= game.cellCount; i++) {\n            // 从上往下 ---- 横着画\n            var p1 = i * game.cellWidth;;\n            ctx.moveTo(p1, 0);\n            ctx.lineTo(p1, this.height);\n            // 从左往右 | 竖着画\n            var p2 = i * game.cellWidth;\n            ctx.moveTo(0, p2);\n            ctx.lineTo(this.width, p2);\n        }\n        // 设置填充色\n        ctx.strokeStyle = \"#555\";\n        // 画完格子啦\n        ctx.stroke();\n        //绘制子元素（所有在棋盘上的棋子）\n        this.bubbles.forEach(function (row) {\n            row.forEach(function (bubble) {\n                bubble.draw();\n            });\n        });\n        // 恢复之前缓存的数据\n        ctx.restore();\n    },\n    isMoving: false,\n\n    // 将一枚棋子移动到指定地方\n    move: function (bubble, target) {\n        var path = this.search(bubble.x, bubble.y, target.x, target.y);\n        // 注意：这条路径是反向操作！！\n        if (!path) {\n            //显示不能移动s\n            //alert(\"过不去\");\n            return;\n        }\n\n        //map开始播放当前棋子的移动效果\n        //两种实现方式，1、map按路径染色，最后达到目的地 2、map生成一个临时的bubble负责展示，到目的地后移除\n        //log(path);\n        var me = this;\n        var name = \"move_\" + bubble.x + \"_\" + bubble.y;\n        var i = path.length - 1;\n        var color = bubble.color;\n        game.play(name, function () {\n            if (i < 0) {\n                game.stop(name);\n                game.clicked = null;\n                me.isMoving = false;\n                me.clearLine(target.x, target.y, color, true);\n                return;\n            }\n            me.isMoving = true;\n            path.forEach(function (cell) {\n                me.setBubble(cell.x, cell.y, null);\n            });\n            var currentCell = path[i];\n            me.setBubble(currentCell.x, currentCell.y, color);\n            i--;\n        }, 110);\n    },\n\n    // 光说不行，我们得找一条路吧？\n    // 这里查找从 1 到 2 的路径\n    // 这并不是最短路径算法\n    search: function (x1, y1, x2, y2) {\n        var history = [];\n        var goalCell = null;\n        var me = this;\n        getCell(x1, y1, null);\n        // 如果从起点出发，能到达目标点\n        if (goalCell) {\n            var path = [];\n\n            var cell = goalCell;\n            while (cell) {\n                path.push({ \"x\": cell.x, \"y\": cell.y });\n                cell = cell.parent;\n            }\n            return path;\n        }\n        return null;\n\n        // 获取所有相邻的格子的权重\n        // 这块怎么解释呢？一次只能跨一个格子，那么找到所有从 A 点出发后能到达的点\n        function getCell(x, y, parent) {\n            if (goalCell) return // NOTICE: 这是新增的优化方式\n            // 这里的bubbles存的是列和行数\n            if (x >= me.bubbles.length || y >= me.bubbles.length)\n                return;\n\n            if (x != x1 && y != y2 && !me.isEmpty(x, y))\n                return;\n\n            // 如果是一个跑过的格子，则忽略\n            for (var i = 0; i < history.length; i++) {\n                if (history[i].x == x && history[i].y == y)\n                    return;\n            }\n            var cell = { \"x\": x, \"y\": y, child: [], \"parent\": parent };\n            // 终点也会被放到 history 中\n            // 也就是，如果已经找到路线，那么不会有第二条路线\n            // 因为终点已经被这条路线占用了\n            // 因此有个可以优化的点就是：如果 goalcell 已经存在，则不再继续找路线\n            history.push(cell);\n\n            // 如果已经到达终点，那咱就不说啥了\n            if (cell.x == x2 && cell.y == y2) {\n                goalCell = cell;\n                return cell;\n            }\n            var child = [];\n            var left, top, right, buttom;\n            //最短路径的粗略判断就是首选目标位置的大致方向\n            // 当前cell的四个方向有哪些可选路径\n            if (x - 1 >= 0 && me.isEmpty(x - 1, y))\n                child.push({ \"x\": x - 1, \"y\": y });\n            if (x + 1 < me.bubbles.length && me.isEmpty(x + 1, y))\n                child.push({ \"x\": x + 1, \"y\": y });\n            if (y + 1 < me.bubbles.length && me.isEmpty(x, y + 1))\n                child.push({ \"x\": x, \"y\": y + 1 });\n            if (y - 1 >= 0 && me.isEmpty(x, y - 1))\n                child.push({ \"x\": x, \"y\": y - 1 });\n            var distance = [];\n            for(var i=0;i<child.length;i++){\n                var c = child[i];\n                if(c){\n                    // 权值的计算方式 x 轴和 y 轴的距离之和\n                    distance.push({\"i\":i,\"d\":Math.abs(x2 - c.x) + Math.abs(y2 - c.y)});\n                }else{\n                    // 这块不会执行的\n                    alert('这块不会执行的')\n                    distance.push({\"i\":i,\"d\":-1});\n                }\n            };\n            // 这里根据权值排下序\n            distance.sort(function (a, b) { return a.d - b.d });\n\n            for (var i = 0; i < child.length; i++) {\n                var d = distance[i];\n                var c = child[d.i];\n                if (c) cell.child.push(getCell(c.x, c.y, cell));\n            }\n\n            return cell;\n        }\n    },\n    // 获取空的棋子落框 TODO：这个暂时还不确定是否只是放置一枚棋子的盒子\n    getEmptyBubbles: function () {\n        var empties = [];\n        this.bubbles.forEach(function (row) {\n            row.forEach(function (bubble) {\n                if (!bubble.color) {\n                    empties.push(new Bubble(bubble.x, bubble.y));\n                }\n            });\n        });\n        if (empties.length <= 3) {\n            return [];\n        }\n        var result = [];\n        var useds = [];\n        for (var i = 0; i < empties.length; i++) {\n            if (result.length == 3) {\n                break;\n            }\n            var isUsed = false;\n            var ra = game.getRandom(empties.length);\n            for (var m = 0; m < useds.length; m++) {\n                isUsed = ra === useds[m];\n                if (isUsed) break;\n            }\n            if (!isUsed) {\n                result.push(empties[ra]);\n                useds.push(ra);\n            }\n        }\n        //log(useds);\n        return result;\n    },\n\n    addBubble: function (bubble) {\n        var thisBubble = this.getBubble(bubble.x, bubble.y);\n        thisBubble.color = bubble.color;\n    },\n\n    setBubble: function (x, y, color) {\n        this.getBubble(x, y).color = color;\n    },\n\n    getBubble: function (x, y) {\n        if (x < 0 || y < 0 || x > game.cellCount || y > game.cellCount) return null;\n        return this.bubbles[y][x];\n    },\n    isEmpty: function (x, y) {\n        var bubble = this.getBubble(x, y);\n        return !bubble.color;\n    },\n};\nvar Cell = function (x, y) {\n    this.x = x;\n    this.y = y;\n\n}\nwindow.count = 0\nvar Bubble = function (x, y, color) {\n    this.x = x;     // 几行几列\n    this.y = y;\n    // 这个地址是相对棋盘左上角而言\n    // 所以如果要获取相对于整个画布的位置，则需要加上 map.startX map.startY 的坐标\n    this.px = game.cellWidth * (this.x + 1) - game.cellWidth / 2;   // 像素中心点\n    this.py = game.cellWidth * (this.y + 1) - game.cellWidth / 2;\n    this.color = color;\n    this.light = 10;\n};\nBubble.prototype.draw = function () {\n    if (!this.color) {\n        return;\n    }\n    // console.log('draw')\n    var ctx = game.ctx;\n    ctx.beginPath();\n    //log(\"x:\" + px + \"y:\" + py);\n    // 创建环形渐变\n    var gradient = ctx.createRadialGradient(this.px - 5, this.py - 5, 0, this.px, this.py, this.light);\n    gradient.addColorStop(0, \"white\");\n    gradient.addColorStop(1, this.color);\n    // 画一个圆形棋子\n    ctx.arc(this.px, this.py, 11, 0, Math.PI * 2);\n    ctx.strokeStyle = this.color;\n    ctx.fillStyle = gradient;\n    ctx.fill();\n    ctx.stroke();\n};\n/**\n * 棋子开始闪烁\n */\nBubble.prototype.play = function () {\n    var me = this;\n    var isUp = true;\n    game.play(\"light_\" + this.x + \"_\" + this.y, function () {\n        if (isUp) {\n            me.light += 3;\n        }\n\n        if (!isUp) {\n            me.light -= 3;\n        }\n        if (me.light >= 30) {\n            isUp = false;\n        }\n        if (me.light <= 10) {\n            isUp = true;\n        }\n    }, 50);\n};\n/**\n * 棋子结束闪烁\n */\nBubble.prototype.stop = function () {\n    //this.light = 10;\n    var me = this;\n    game.stop(\"light_\" + this.x + \"_\" + this.y);\n\n    // 停止闪烁后如果棋子还是高亮状态\n    // 则取消高亮\n    game.play(\"restore_\" + this.x + \"_\" + this.y, function () {\n        if (me.light > 10) {\n            me.light--;\n        }\n        else {\n            me.light = 10;\n            game.stop(\"restore_\" + me.x + \"_\" + me.y);\n        }\n    }, 50);\n};\n\nfunction log(...arg) {\n    console.log(...arg)\n}\n\nexport default game;"]}